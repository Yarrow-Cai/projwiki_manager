# ProjWiki Manager - 嵌入式项目技术文档管理 Skill

## 简介

ProjWiki Manager 是一个专为嵌入式微逆变器项目（GD32G553 YTC2400W）设计的技术文档管理 Skill。它能够帮助你创建、更新和浏览项目技术文档，并自动生成可在浏览器中查看的 HTML 文档站点。

**核心特性**：
- 📝 基于模板快速创建技术文档（模块、API、设计、硬件接口、变更日志）
- 🔄 智能更新已有文档，保持格式一致性
- 🌐 一键生成自包含 HTML 文档站点（零依赖，双击即可打开）
- 🔍 内置全文搜索功能（支持标题、内容、标签搜索）
- 📂 分类导航（按四层架构：应用层/中间层/计算层/硬件层）
- 🌙 亮色/暗色主题切换
- 🖨️ 打印友好的页面布局
- ⌨️ 键盘快捷键支持（`Ctrl+K` 或 `/` 聚焦搜索）

## 快速开始

### 1. 创建文档

直接向 AI 描述你需要的文档：

```
帮我为 BSP_TIMER 模块创建技术文档
```

```
从 MDW_PWM.h 自动生成 API 文档
```

```
创建并网逆变控制的设计文档
```

### 2. 更新文档

```
更新 MDW_Sensor 文档，添加新增的温度采样通道
```

### 3. 生成 HTML 文档站点

```
生成文档站点
```

或手动运行构建脚本：

```bash
python .claude/skills/projwiki_manager/scripts/build_wiki.py
```

### 4. 查看文档

生成的 HTML 文件位于：

```
.zed/.projwiki/_site/index.html
```

直接在浏览器中打开即可查看全部文档。

## 目录结构

### Skill 文件

```
.claude/skills/projwiki_manager/
├── SKILL.md                    # 主技能定义文件
├── README.md                   # 本使用说明
├── EXAMPLES.md                 # 详细使用示例
├── scripts/
│   ├── build_wiki.py           # HTML 站点构建脚本
│   └── viewer_template.html    # HTML 查看器模板
└── templates/
    ├── module_doc.md           # 模块文档模板
    ├── api_doc.md              # API 接口文档模板
    ├── design_doc.md           # 设计文档模板
    ├── hw_interface_doc.md     # 硬件接口文档模板
    └── changelog.md            # 变更日志模板
```

### 文档存储

```
.zed/.projwiki/
├── index.md                    # 首页 / 项目总览
├── modules/                    # 模块文档
│   ├── app_xxx.md              #   应用层模块
│   ├── mdw_xxx.md              #   中间层模块
│   ├── calc_xxx.md             #   计算层模块
│   └── bsp_xxx.md              #   硬件层模块
├── api/                        # API 接口文档
│   └── xxx_api.md
├── design/                     # 设计文档
│   └── xxx_design.md
├── hardware/                   # 硬件接口文档
│   └── xxx_hw.md
├── changelog/                  # 变更日志
│   └── YYYY-MM.md
└── _site/
    └── index.html              # 生成的 HTML 查看器（自动生成）
```

## 文档分类说明

| 分类 | 目录 | 用途 | 适用场景 |
|------|------|------|---------|
| **模块文档** | `modules/` | 软件模块的详细说明 | 为每个 .c/.h 文件创建文档 |
| **API 文档** | `api/` | 公开接口的详细规格 | 头文件中函数的完整使用指南 |
| **设计文档** | `design/` | 架构设计和功能设计 | 新功能开发前的技术方案 |
| **硬件接口** | `hardware/` | 硬件电路和外设配置 | MCU 引脚、外设、信号调理 |
| **变更日志** | `changelog/` | 代码变更记录 | 按月记录新增/修复/优化 |

## 文档编写规范

### 1. 文档头部（必须）

每个文档必须包含 YAML frontmatter：

```yaml
---
title: 文档标题
category: modules | api | design | hardware | changelog
date: 2025-07-11
author: Yarrow
tags: [标签1, 标签2]
status: draft | review | published
---
```

### 2. 状态说明

| 状态 | 含义 | 显示颜色 |
|------|------|---------|
| `draft` | 草稿，尚未完成 | 黄色 |
| `review` | 待评审 | 蓝色 |
| `published` | 已发布 | 绿色 |

### 3. 安全关键内容

涉及功率级、保护逻辑或中断时序的内容，必须使用告警块：

```markdown
> **WARNING**: 死区时间直接关系GaN器件安全，最小值200ns，严禁低于此值！
```

### 4. 文件命名

- 只使用小写字母、数字和下划线
- 格式：`<模块名>.md`，如 `bsp_timer.md`、`mdw_pwm_api.md`
- 变更日志：`YYYY-MM.md`，如 `2025-07.md`

## 构建脚本详解

### 运行方式

```bash
# 在项目根目录运行
python .claude/skills/projwiki_manager/scripts/build_wiki.py
```

### 工作原理

1. **扫描**：递归扫描 `.zed/.projwiki/` 目录下所有 `.md` 文件
2. **解析**：提取每个文件的 YAML frontmatter 和标题结构
3. **分类**：根据文件路径和 frontmatter 中的 `category` 字段进行分类
4. **注入**：将文档数据序列化为 JSON，注入到 HTML 模板中
5. **输出**：生成自包含的 `_site/index.html`

### 输出示例

```
[INFO] Project root : D:\CYC\PROJUSE\YTC_code
[INFO] Wiki directory: D:\CYC\PROJUSE\YTC_code\.zed\.projwiki
[INFO] Output dir    : D:\CYC\PROJUSE\YTC_code\.zed\.projwiki\_site

[INFO] Found 8 document(s)
[INFO] Categories: root(1), modules(3), api(2), design(1), hardware(1)

[OK] Generated: D:\CYC\PROJUSE\YTC_code\.zed\.projwiki\_site\index.html
[OK] File size: 156.3 KB
[OK] Open in browser to view documentation
```

### 环境要求

- Python 3.6+（标准库，无需额外安装任何包）

## HTML 查看器功能

### 界面布局

```
┌──────────────────────────────────────────────────────────┐
│  [≡]  📖 YTC2400W Docs  [🔍 搜索...]  [8篇] [🌙]       │  <- 顶部栏
├────────┬─────────────────────────────────┬───────────────┤
│        │                                 │               │
│ 项目总览│     文档内容区域                 │  目录 (TOC)   │
│ ▶ 模块 │                                 │               │
│   BSP_ │     # 文档标题                  │  概述          │
│   MDW_ │                                 │  功能描述      │
│   CALC_│     ## 章节                     │  公开接口      │
│   APP_ │                                 │  数据结构      │
│ ▶ API  │     正文内容...                 │  使用示例      │
│ ▶ 设计 │                                 │  ...          │
│ ▶ 硬件 │                                 │               │
│ ▶ 变更 │                                 │               │
│        │                                 │               │
├────────┴─────────────────────────────────┴───────────────┤
│                                                    [↑]   │  <- 回到顶部
└──────────────────────────────────────────────────────────┘
```

### 功能列表

| 功能 | 说明 |
|------|------|
| **分类导航** | 左侧栏按分类折叠/展开文档列表 |
| **全文搜索** | 搜索标题、内容和标签，实时显示结果和上下文片段 |
| **目录导航** | 右侧栏显示当前文档标题结构，点击跳转 |
| **主题切换** | 亮色/暗色主题，自动保存偏好 |
| **状态标识** | 文档状态彩色圆点（绿=已发布、黄=草稿、蓝=待审） |
| **面包屑** | 显示当前文档的分类路径 |
| **元数据** | 显示作者、日期、修改时间、标签 |
| **回到顶部** | 滚动超过一定距离后显示回到顶部按钮 |
| **直链分享** | URL hash 包含文档路径，可直接分享链接 |
| **键盘快捷键** | `Ctrl+K` 或 `/` 聚焦搜索框，`Esc` 关闭搜索 |
| **响应式布局** | 自动适配不同屏幕尺寸 |
| **打印支持** | 打印时隐藏导航元素，只保留文档内容 |

### Markdown 支持

HTML 查看器内置轻量级 Markdown 渲染器，支持以下语法：

- 标题（h1-h6）
- 段落和换行
- **粗体**、*斜体*、~~删除线~~
- `行内代码` 和代码块（带语言标签）
- 链接和图片
- 有序列表和无序列表
- 引用块（自动识别 WARNING 告警）
- 表格（带滚动包裹）
- 水平线
- 嵌套列表

## 模板说明

### module_doc.md - 模块文档模板

适用于为 Application / Middleware / Calculation / Hardware 层的模块创建文档。包含：
- 模块概述和架构位置
- 依赖关系图
- 公开接口表格
- 数据结构定义
- 使用示例
- 中断与时序说明
- 安全与保护机制
- 校准参数表
- 变更历史

### api_doc.md - API 接口文档模板

适用于详细描述模块的公开接口。包含：
- 接口总览
- 类型定义（结构体、枚举、回调）
- 每个函数的详细说明（参数、返回值、前置条件、注意事项）
- 调用时序和状态约束
- 使用示例和错误处理示例
- 线程/中断安全性矩阵
- 性能指标

### design_doc.md - 设计文档模板

适用于新功能开发前的技术方案设计。包含：
- 需求分析（功能/性能/安全需求）
- 系统架构（四层架构中的定位）
- 详细设计（状态机、算法、数据结构、接口、时序）
- 硬件资源占用
- 安全分析（风险、保护策略、失效安全）
- 测试计划
- 实施计划

### hw_interface_doc.md - 硬件接口文档模板

适用于 MCU 外设和硬件电路的接口说明。包含：
- 引脚映射和电气参数
- 外设配置（时钟、寄存器、DMA）
- 信号调理电路
- 时序参数（PWM、ADC、通信）
- 保护机制和死区设置
- 校准流程
- PCB 布局注意事项

### changelog.md - 变更日志模板

适用于按月记录代码变更。包含：
- 按日期分组的变更记录
- 新增功能 / 问题修复 / 功能优化 / 参数变更
- 安全相关变更（含评审记录）
- 版本汇总表
- 待办事项

## 注意事项

1. **不要手动编辑** `_site/index.html`，它由构建脚本自动生成
2. 每次文档变更后建议重新运行构建脚本
3. 涉及安全关键内容的文档变更应标注 `status: review`
4. 构建脚本只需要 Python 3.6+ 标准库，无额外依赖
5. 生成的 HTML 是完全自包含的，可以复制到任何地方查看
6. `.zed/.projwiki/_site/` 目录建议加入 `.gitignore`

## 故障排除

| 问题 | 原因 | 解决方法 |
|------|------|---------|
| 构建脚本报错找不到模板 | `viewer_template.html` 不在 scripts 目录 | 确认文件路径正确 |
| 生成的 HTML 无内容 | `.projwiki/` 下没有 .md 文件 | 先创建文档再构建 |
| 文档分类错误 | frontmatter 中 category 字段缺失 | 添加正确的 YAML 头部 |
| 搜索无结果 | 搜索关键词少于2个字符 | 输入至少2个字符 |
| 页面样式异常 | 浏览器不支持 CSS 变量 | 使用现代浏览器（Chrome/Firefox/Edge） |

## 版本历史

| 版本 | 日期 | 说明 |
|------|------|------|
| v1.0 | 2025-07-11 | 初始版本 |